<script src="{{ 'marquee.js' | asset_url }}" type="module"></script>

<section class="announcement-bar-marquee-section">
  <marquee-component
    class="announcement-bar-marquee"
    style="
      --marquee-direction: {{ section.settings.movement_direction }};
      background-color: {{ section.settings.background_color }};
      color: {{ section.settings.text_color }};
      padding-top: {{ section.settings.padding_top | default: 12 }}px;
      padding-bottom: {{ section.settings.padding_bottom | default: 12 }}px;
    "
    data-speed-factor="{{ section.settings.speed_factor | default: 20 }}"
    data-movement-direction="{{ section.settings.movement_direction }}"
  >
    <div class="marquee__wrapper" ref="wrapper">
      <div class="marquee__content" ref="content">
        <div class="marquee__repeated-items">
          {% for block in section.blocks %}
            {% if block.type == 'message' %}
              <span class="announcement-bar__message">{{ block.settings.text }}</span>
            {% endif %}
          {% endfor %}
          {% if section.blocks.size == 0 %}
            <span class="announcement-bar__message">{{ section.settings.default_message }}</span>
          {% endif %}
        </div>
      </div>
    </div>
  </marquee-component>
</section>

{% stylesheet %}
.announcement-bar-marquee-section {
  width: 100%;
  overflow: hidden;
}

.announcement-bar-marquee {
  display: block;
  width: 100%;
  overflow: hidden;
}

.marquee__wrapper {
  display: flex;
  gap: var(--marquee-gap, 3rem);
  width: fit-content;
  white-space: nowrap;
}

.marquee__content {
  min-width: max-content;
  display: flex;
  gap: var(--marquee-gap, 3rem);
}

.marquee__repeated-items {
  min-width: max-content;
  display: flex;
  gap: var(--marquee-gap, 3rem);
  align-items: center;
  justify-content: center;
}

.announcement-bar__message {
  font-size: 1.1rem;
  font-weight: 500;
  letter-spacing: 0.05em;
  white-space: nowrap;
}

@media (prefers-reduced-motion: no-preference) {
  marquee-component:not([data-disabled]) .marquee__wrapper {
    animation: marquee-motion var(--marquee-speed, 20s) linear infinite;
  }
}

@keyframes marquee-motion {
  to {
    transform: translate3d(-50%, 0, 0);
  }
}
{% endstylesheet %}

{% schema %}
{
  "name": "Announcement Bar (Marquee)",
  "settings": [
    {
      "type": "text",
      "id": "default_message",
      "label": "Default message (when no blocks added)",
      "default": "ðŸš€ Welcome to our store! Enjoy free shipping on all orders! ðŸš€"
    },
    {
      "type": "select",
      "id": "movement_direction",
      "label": "Movement direction",
      "options": [
        {
          "value": "normal",
          "label": "Left to Right"
        },
        {
          "value": "reverse",
          "label": "Right to Left"
        }
      ],
      "default": "reverse"
    },
    {
      "type": "range",
      "id": "speed_factor",
      "label": "Speed",
      "min": 10,
      "max": 50,
      "step": 5,
      "default": 20,
      "info": "Lower values = faster speed"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#222222"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top (px)",
      "min": 0,
      "max": 60,
      "step": 2,
      "default": 12
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom (px)",
      "min": 0,
      "max": 60,
      "step": 2,
      "default": 12
    }
  ],
  "blocks": [
    {
      "type": "message",
      "name": "Message",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Message text",
          "default": "New announcement message"
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "Announcement Bar (Marquee)",
      "blocks": [
        { "type": "message", "settings": { "text": "ðŸš€ Welcome to our store! Free shipping on orders over $50! ðŸš€" } },
        { "type": "message", "settings": { "text": "ðŸŽ‰ Summer Sale! Up to 50% off selected items! ðŸŽ‰" } },
        { "type": "message", "settings": { "text": "ðŸ“¦ Fast delivery available! Order before 2PM for same-day dispatch! ðŸ“¦" } }
      ]
    }
  ]
}
{% endschema %}
