{% comment %} Section layout style {% endcomment %}
{{ 'tpt-section.css' | asset_url | stylesheet_tag }}

{% comment %} Section configuration {% endcomment %}
{%- render 'tpt-section-setting', section: section -%}

{%- if section.index and section.settings.section_lazyload -%}
  <script src="{{ 'tpt-section-lazyload.js' | asset_url }}" defer="defer"></script>

  <tpt-section-lazyload data-url="?section_id={{ section.id }}">
    <div data-lazyload-element></div>
    <span class="tpt-section_loader"></span>
  </tpt-section-lazyload>
{%- else -%}

  {% comment %} Current section style {% endcomment %}
  {{ 'tpt-testimonials.css' | asset_url | stylesheet_tag }}

  {% comment %} Testimonials JavaScript {% endcomment %}
  <script src="{{ 'tpt-testimonials.js' | asset_url }}" defer="defer"></script>

  <div class="tpt-section_container" style="width: 100%;">
    <div class="tpt-section_content">
      {% comment %} Section header {% endcomment %}
      {%- render 'tpt-section-header', section: section -%}
      
      <div class="tpt-section-body">
        {% comment %} Section body {% endcomment %}
        <div class="tpt-testimonials" 
             data-section-id="{{ section.id }}"
             data-auto-play="{{ section.settings.auto_play }}"
             data-play-speed="{{ section.settings.play_speed }}"
             data-animation-style="{{ section.settings.animation_style }}">
          
          {% comment %} Navigation arrows {% endcomment %}
          <div class="tpt-testimonials__navigation">
            <button class="tpt-testimonials__nav tpt-testimonials__nav--prev" aria-label="Previous testimonial">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <button class="tpt-testimonials__nav tpt-testimonials__nav--next" aria-label="Next testimonial">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>

          {% comment %} Testimonials container {% endcomment %}
          <div class="tpt-testimonials__container">
            <div class="tpt-testimonials__track">
              {% for block in section.blocks %}
                {% if block.settings.enable_testimonial %}
                  <div class="tpt-testimonials__slide" {{ block.shopify_attributes }}>
                    <div class="tpt-testimonial__card">
                      
                      {% comment %} Quote icon {% endcomment %}
                      <div class="tpt-testimonial__quote-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                          <path d="M14.017 21V9.01L21 9L19.951 8.984C18.498 8.984 17.515 8.984 17.015 8.484C16.515 7.984 16.515 7 16.515 5.515V3.515C16.515 2.515 17.515 1.515 18.515 1.515H21.515C22.515 1.515 23.515 2.515 23.515 3.515V8.515C23.515 12.515 20.515 15.515 16.515 15.515H16.017V21H14.017ZM2.017 21V9.01L9 9L7.951 8.984C6.498 8.984 5.515 8.984 5.015 8.484C4.515 7.984 4.515 7 4.515 5.515V3.515C4.515 2.515 5.515 1.515 6.515 1.515H9.515C10.515 1.515 11.515 2.515 11.515 3.515V8.515C11.515 12.515 8.515 15.515 4.515 15.515H4.017V21H2.017Z" fill="currentColor"/>
                        </svg>
                      </div>

                      {% comment %} Testimonial content {% endcomment %}
                      <div class="tpt-testimonial__content">
                        {% if block.settings.testimonial_text != blank %}
                          <blockquote class="tpt-testimonial__text">
                            {{ block.settings.testimonial_text }}
                          </blockquote>
                        {% endif %}
                      </div>

                      {% comment %} Star rating {% endcomment %}
                      {% if block.settings.show_rating and block.settings.rating > 0 %}
                        <div class="tpt-testimonial__rating">
                          {% assign rating = block.settings.rating %}
                          {% for i in (1..5) %}
                            <span class="tpt-testimonial__star {% if i <= rating %}tpt-testimonial__star--filled{% endif %}">
                              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" fill="currentColor"/>
                              </svg>
                            </span>
                          {% endfor %}
                        </div>
                      {% endif %}

                      {% comment %} Customer info {% endcomment %}
                      <div class="tpt-testimonial__customer">
                        <div class="tpt-testimonial__customer-info">
                          {% if block.settings.customer_image != blank %}
                            <div class="tpt-testimonial__avatar">
                              <img src="{{ block.settings.customer_image | image_url: width: 120 }}" 
                                   alt="{{ block.settings.customer_name | escape }}"
                                   loading="lazy"
                                   width="60" 
                                   height="60">
                            </div>
                          {% else %}
                            <div class="tpt-testimonial__avatar tpt-testimonial__avatar--placeholder">
                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                            </div>
                          {% endif %}
                          
                          <div class="tpt-testimonial__customer-details">
                            {% if block.settings.customer_name != blank %}
                              <h4 class="tpt-testimonial__customer-name">{{ block.settings.customer_name }}</h4>
                            {% endif %}
                            {% if block.settings.customer_title != blank %}
                              <p class="tpt-testimonial__customer-title">{{ block.settings.customer_title }}</p>
                            {% endif %}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          </div>

          {% comment %} Pagination dots {% endcomment %}
          <div class="tpt-testimonials__pagination">
            {% assign testimonial_count = 0 %}
            {% for block in section.blocks %}
              {% if block.settings.enable_testimonial %}
                {% assign testimonial_count = testimonial_count | plus: 1 %}
              {% endif %}
            {% endfor %}
            
            {% for i in (1..testimonial_count) %}
              <button class="tpt-testimonials__dot {% if forloop.first %}tpt-testimonials__dot--active{% endif %}" 
                      data-slide="{{ forloop.index0 }}"
                      aria-label="Go to testimonial {{ forloop.index }}"></button>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
{%- endif -%}

{%- unless content_for_header contains 'tapita-section-script-tags' -%}
  {% style %}#shopify-section-{{ section.id }}{display: none !important;}{% endstyle %}
{%- endunless -%}

{% schema %}
{
  "name": "Tpt - Testimonials",
  "class": "section tpt-section",
  "tag": "section",
  "settings": [
    {
      "type": "header",
      "content": "Section header"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "default": "What Our Customers Say",
      "label": "Heading"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "options": [
        {
          "value": "h4",
          "label": "Small"
        },
        {
          "value": "h2",
          "label": "Medium"
        },
        {
          "value": "h0",
          "label": "Large"
        }
      ],
      "default": "h2"
    },
    {
      "type": "inline_richtext",
      "id": "sub_heading",
      "label": "Sub-heading"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Discover why our customers love us. Read their authentic reviews and experiences.</p>"
    },
    {
      "type": "select",
      "id": "alignment",
      "label": "Alignment",
      "options": [
        {
          "value": "default",
          "label": "Default"
        },
        {
          "value": "center",
          "label": "Center"
        }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "select",
      "id": "animation_style",
      "label": "Animation style",
      "options": [
        {
          "value": "fade",
          "label": "Fade"
        },
        {
          "value": "slide",
          "label": "Slide"
        },
        {
          "value": "scale",
          "label": "Scale"
        }
      ],
      "default": "slide"
    },
    {
      "type": "checkbox",
      "id": "auto_play",
      "label": "Auto play",
      "default": true
    },
    {
      "type": "range",
      "id": "play_speed",
      "min": 3000,
      "max": 10000,
      "step": 500,
      "unit": "ms",
      "label": "Auto play speed",
      "default": 5000
    },
    {
      "type": "header",
      "content": "Section colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#f8f9fa"
    },
    {
      "type": "color",
      "id": "card_background_color",
      "label": "Card background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#2c3e50"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent color (stars, quotes)",
      "default": "#f39c12"
    },
    {
      "type": "header",
      "content": "Section layout"
    },
    {
      "type": "checkbox",
      "id": "section_full_width",
      "label": "Section full width",
      "default": true
    },
    {
      "type": "range",
      "id": "section_max_width",
      "min": 1200,
      "max": 1900,
      "step": 20,
      "unit": "px",
      "label": "Section max width",
      "default": 1600
    },
    {
      "type": "checkbox",
      "id": "content_full_width",
      "label": "Content full width",
      "default": false
    },
    {
      "type": "range",
      "id": "content_max_width",
      "min": 1200,
      "max": 1900,
      "step": 20,
      "unit": "px",
      "label": "Content max width",
      "default": 1400
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "Section padding top",
      "default": 80
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "Section padding bottom",
      "default": 80
    },
    {
      "type": "header",
      "content": "Section optimize"
    },
    {
      "type": "checkbox",
      "id": "section_lazyload",
      "label": "Section lazyload",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "checkbox",
          "id": "enable_testimonial",
          "label": "Enable testimonial",
          "default": true
        },
        {
          "type": "textarea",
          "id": "testimonial_text",
          "label": "Testimonial text",
          "default": "This product has completely exceeded my expectations. The quality is outstanding and the customer service is exceptional. I couldn't be happier with my purchase!"
        },
        {
          "type": "text",
          "id": "customer_name",
          "label": "Customer name",
          "default": "Sarah Johnson"
        },
        {
          "type": "text",
          "id": "customer_title",
          "label": "Customer title",
          "default": "Verified Buyer"
        },
        {
          "type": "image_picker",
          "id": "customer_image",
          "label": "Customer photo"
        },
        {
          "type": "checkbox",
          "id": "show_rating",
          "label": "Show star rating",
          "default": true
        },
        {
          "type": "range",
          "id": "rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "label": "Star rating",
          "default": 5
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Tpt - Testimonials",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "enable_testimonial": true,
            "testimonial_text": "This product has completely exceeded my expectations. The quality is outstanding and the customer service is exceptional. I couldn't be happier with my purchase!",
            "customer_name": "Sarah Johnson",
            "customer_title": "Verified Buyer",
            "show_rating": true,
            "rating": 5
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "enable_testimonial": true,
            "testimonial_text": "Amazing experience from start to finish. Fast shipping, excellent packaging, and the product works exactly as described. Highly recommend!",
            "customer_name": "Michael Chen",
            "customer_title": "Happy Customer",
            "show_rating": true,
            "rating": 5
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "enable_testimonial": true,
            "testimonial_text": "Outstanding customer service and top-notch products. I've been shopping here for years and they never disappoint. Five stars!",
            "customer_name": "Emily Rodriguez",
            "customer_title": "Loyal Customer",
            "show_rating": true,
            "rating": 4
          }
        }
      ]
    }
  ]
}
{% endschema %}
