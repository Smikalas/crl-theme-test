{%- style -%}
  .featured-collection-image {
    padding: var(--grid-desktop-horizontal-spacing) 0;
  }
  
  .featured-collection-image.full-width {
    padding: 0;
    max-width: 100%;
    margin: 0;
  }

  .collection-image-grid {
    display: grid;
    grid-template-columns: repeat({{ section.settings.columns_desktop }}, 1fr);
    grid-gap: {{ section.settings.gap }}px;
  }
  
  .full-width .collection-image-grid {
    margin: 0;
    padding: 0;
  }

  .collection-image-item {
    position: relative;
    overflow: hidden;
    border-radius: {{ section.settings.border_radius }}px;
    aspect-ratio: {{ section.settings.aspect_ratio }};
  }

  .collection-image-item__link {
    display: block;
    height: 100%;
    width: 100%;
    position: relative;
    overflow: hidden;
  }

  .collection-image-item__media {
    position: absolute;
    height: 100%;
    width: 100%;
    object-fit: cover;
    transform: scale(1);
    transition: transform 0.8s cubic-bezier(0.215, 0.61, 0.355, 1);
  }

  .collection-image-item__overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to bottom,
      transparent 60%,
      rgba(0, 0, 0, 0.5) 100%
    );
    opacity: 1;
    transition: opacity 0.4s ease;
  }

  .collection-image-item__content {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: var(--spacing-extra-large);
    transform: translateY(0);
    opacity: 1;
    transition: all 0.4s ease;
  }

  .collection-image-item__title {
    color: rgb(var(--color-background));
    margin: 0;
    font-size: calc(var(--font-heading-scale) * 2.2rem);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 600;
    position: relative;
    padding-bottom: 0.5em;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
  }

  .collection-image-item__title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 60px;
    height: 2px;
    background-color: rgb(var(--color-background));
    transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1);
    transform-origin: left center;
  }

  @media screen and (max-width: 749px) {
    .collection-image-grid {
      grid-template-columns: repeat({{ section.settings.columns_mobile }}, 1fr);
    }
    
    .collection-image-item__title {
      font-size: calc(var(--font-heading-scale) * 1.8rem);
    }
  }

  @media (hover: hover) {
    .collection-image-item:hover .collection-image-item__media {
      transform: scale(1.05);
    }

    .collection-image-item:hover .collection-image-item__title::after {
      width: 100%;
    }
  }
{%- endstyle -%}

<div class="featured-collection-image{% if section.settings.full_width %} full-width{% else %} page-width{% endif %}">
  {% if section.settings.title != blank %}
    <div class="title-wrapper-with-link{% if section.settings.title == blank %} title-wrapper-with-link--no-heading{% endif %} {% if section.settings.secondary_title == blank %} title-wrapper-with-link--no-heading{% endif %}">
      <h2 class="title {{ section.settings.heading_size }}">{{ section.settings.title | escape }}</h2>
      {% if section.settings.secondary_title != blank %}
        <h3>{{ section.settings.secondary_title | escape }}</h3>
      {% endif %}
    </div>
  {% endif %}

  <div class="collection-image-grid">
    {%- for block in section.blocks -%}
      <div class="collection-image-item" {{ block.shopify_attributes }}>
        <a href="{{ block.settings.link }}" class="collection-image-item__link">
          {% if block.settings.image != blank %}
            {{
              block.settings.image
              | image_url: width: 2000
              | image_tag:
                loading: 'lazy',
                class: 'collection-image-item__media'
            }}
          {% else %}
            {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder collection-image-item__media' }}
          {% endif %}
          <div class="collection-image-item__overlay"></div>
          <div class="collection-image-item__content">
            <h2 class="collection-image-item__title">
              {{ block.settings.title | escape }}
            </h2>
          </div>
        </a>
      </div>
    {%- endfor -%}
  </div>
</div>

{% schema %}
{
  "name": "Collection Image Grid",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Featured Collections"
    },
    {
      "type": "text",
      "id": "secondary_title",
      "label": "Secondary heading"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h2",
          "label": "Small"
        },
        {
          "value": "h1",
          "label": "Medium"
        },
        {
          "value": "h0",
          "label": "Large"
        }
      ],
      "default": "h1",
      "label": "Heading size"
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "label": "Image aspect ratio",
      "options": [
        {
          "value": "auto",
          "label": "Adapt to image"
        },
        {
          "value": "1/1",
          "label": "Square (1:1)"
        },
        {
          "value": "2/3",
          "label": "Portrait (2:3)"
        },
        {
          "value": "3/2",
          "label": "Landscape (3:2)"
        },
        {
          "value": "16/9",
          "label": "Widescreen (16:9)"
        }
      ],
      "default": "16/9"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 2,
      "label": "Number of columns on desktop"
    },
    {
      "type": "range",
      "id": "columns_mobile",
      "min": 1,
      "max": 3,
      "step": 1,
      "default": 1,
      "label": "Number of columns on mobile"
    },
    {
      "type": "range",
      "id": "gap",
      "min": 0,
      "max": 40,
      "step": 4,
      "default": 24,
      "label": "Gap between images"
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "default": 0,
      "label": "Image border radius"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full width",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "collection_image",
      "name": "Collection Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "SHOP NEW COLLECTION"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collection Image Grid",
      "blocks": [
        {
          "type": "collection_image",
          "settings": {
            "title": "SHOP NEW MENS"
          }
        },
        {
          "type": "collection_image",
          "settings": {
            "title": "SHOP NEW WOMENS"
          }
        }
      ]
    }
  ]
}
{% endschema %}
